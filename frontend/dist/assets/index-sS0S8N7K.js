const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CA-6fEX3.js","assets/index-DZIOIZze.css","assets/index-DO1XHqEM.js","assets/navbars-F_vH8I19.js"])))=>i.map(i=>d[i]);
import{s as c,c as v,_ as g,g as y}from"./index-CA-6fEX3.js";import{c as b}from"./shapes-7Z1ZtB9Y.js";import{s}from"./notification--NRigmGR.js";function w(){const e=document.createElement("div");e.className="relative flex items-center justify-center min-h-screen bg-gradient-to-r from-purple-500 via-pink-500 to-red-500 animate-fade-bg overflow-hidden";const t=document.createElement("div");t.className="absolute inset-0 overflow-hidden z-0",e.appendChild(t);const n=document.createElement("div");return n.className="relative bg-gray-800 bg-opacity-90 p-8 rounded-lg shadow-lg transform transition duration-500 hover:scale-105 z-10",n.innerHTML+=`
    <h1 class="text-3xl font-bold text-center text-white mb-6">Login</h1>
    <form id="login-form" class="flex flex-col gap-4">
      <div class="relative">
        <input id="email" type="email" placeholder="Email" class="w-full p-3 rounded bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-purple-500" required>
      </div>
      <div class="relative">
        <input id="password" type="password" placeholder="Password" class="w-full p-3 rounded bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-purple-500" required>
      </div>
      <div class="flex flex-row gap-2 items-center">
        <button type="submit" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded transition duration-300">Login</button>
        <div id="g_id_signin"></div>
      </div>
    </form>
    <button id="register-button" class="mt-4 text-purple-300 hover:text-purple-500 transition duration-300 underline">Don't have an account? Register</button>
  `,e.appendChild(n),setInterval(()=>b(t),600),e}async function x(e,t){const n=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!n.ok)throw new Error("Invalid credentials");const o=await n.text();if(o.includes("token")){const{token:l}=JSON.parse(o);return c("token",l),c("2fa","false"),c("2faCode","true"),!1}else if(o.includes("tempToken")){const{tempToken:l}=JSON.parse(o);return c("token",l),c("2fa","true"),c("2faCode","false"),!0}throw new Error("Unexpected response from server")}function E(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function k(e){return/^(?=.*[A-Z]).{8,}$/.test(e)}function _(e,t){return!e||!t?"Please fill in all fields.":E(e)?k(t)?null:"Password must be at least 8 characters long and contain at least one uppercase letter.":"Please enter a valid email address."}const C="863001182336-hluhbj6klucqs9b87ldm58bskjnvb22m.apps.googleusercontent.com";function L(e){var o,l;const t=e.querySelector("#login-form"),n=e.querySelector("#register-button");(o=window.google)==null||o.accounts.id.initialize({client_id:C,callback:async r=>{try{const i=await fetch("/api/auth/google-signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:r.credential})});if(!i.ok){const a=await i.json();s("Google sign-in failed: "+(a.error||i.statusText),"error");return}const{token:d}=await i.json();c("token",d),s("Google sign-in successful!","success"),v(d),history.pushState(null,"","/home"),g(()=>import("./index-CA-6fEX3.js").then(a=>a.r),__vite__mapDeps([0,1])).then(a=>a.router())}catch{s("Google sign-in error","error")}}}),(l=window.google)==null||l.accounts.id.renderButton(document.getElementById("g_id_signin"),{theme:"outline",size:"large"}),t.addEventListener("submit",async r=>{r.preventDefault();const i=document.getElementById("email"),d=document.getElementById("password"),a=i.value.trim(),m=d.value.trim(),p=_(a,m);if(p){s(p,"error");return}try{if(await x(a,m)){const u=document.getElementById("twofa-modal");u&&u.classList.remove("hidden"),s("2FA is enabled. Please enter your 2FA code.","info")}else{s("Login successful!","success");const u=y("token");u&&v(u),history.pushState(null,"","/home"),g(()=>import("./index-CA-6fEX3.js").then(h=>h.r),__vite__mapDeps([0,1])).then(h=>h.router())}}catch(f){const u=f instanceof Error?f.message:"An unknown error occurred";s("Login failed: "+u,"error")}}),n.addEventListener("click",()=>{history.pushState(null,"","/register"),g(()=>import("./index-CA-6fEX3.js").then(r=>r.r),__vite__mapDeps([0,1])).then(r=>r.router())})}function T(e,t){const n=document.createElement("div");n.id="twofa-modal",n.className="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-50";const o=document.createElement("div");o.className="bg-white p-6 rounded-lg shadow-lg w-96 flex flex-col gap-4";const l=document.createElement("h2");l.textContent="Enter 2FA Code",l.className="text-xl font-bold text-gray-700";const r=document.createElement("input");r.id="twofa-code",r.type="text",r.placeholder="Enter 2FA Code",r.className="w-full p-3 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 text-black";const i=document.createElement("button");i.id="verify-2fa-button",i.textContent="Verify 2FA",i.className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded";const d=document.createElement("button");d.textContent="Cancel",d.className="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded",o.appendChild(l),o.appendChild(r),o.appendChild(i),o.appendChild(d),n.appendChild(o),e.appendChild(n),i.addEventListener("click",async()=>{const a=r.value.trim();if(!a){s("Please enter your 2FA code.","error");return}const m=y("token");if(!m){s("No token found. Please log in again.","error");return}try{const p=await fetch("/api/auth/2fa-verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:m,code:a})});if(!p.ok)throw new Error("Invalid 2FA code");const{token:f}=await p.json();c("token",f),c("2faCode","true"),s("2FA verified successfully!","success"),n.classList.add("hidden"),v(f),t()}catch{s("Failed to verify 2FA. Please try again.","error")}}),d.addEventListener("click",()=>{n.classList.add("hidden")})}async function P(e){if(!e)return;e.innerHTML="";const t=w();e.appendChild(t),L(t),T(e,()=>{history.pushState(null,"","/home"),g(()=>import("./index-DO1XHqEM.js"),__vite__mapDeps([2,3,0,1])).then(n=>n.render(e))})}export{P as render};
